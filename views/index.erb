<div class='container'>
  <div class='section'>
    <div class='row center'>
      <a href='https://imas.connpass.com/event/70592/' target='_blank'>
        <img src='img/cover.png' alt='アイマスハッカソン2017'/>
      </a>
    </div>
    <div class='row'>
      <div class='col s12 center'>
        <span style='font-size: 3em;'>残り</span>
        <span id='days' style='font-size: 5em;'>00</span>
        <span style='font-size: 3em;'>日と</span>
        <span id='time' style='font-size: 5em;'>00:00:00</span>
      </div>
    </div>
  </div>
  <div class='row'>
    <div class='col s12 m6'>
      <div class='collection with-header'>
        <div class="collection-header"><h5>チーム一覧</h5></div>
        <% if @entries.any? %>
          <% @teams.each do |team| %>
            <a href="/teams/<%= team['id']%>" class='collection-item blue-text'>
              <%= team['name'] %>
              <% team['members'].each do |member| %>
                <img src='<%= member['avatar_url'] %>' alt='<%= member['nickname'] %>' class='circle' style='width: 20px; height:20px; vertical-align: text-bottom;' />
              <% end %>
            </a>
          <% end %>
        <% else %>
          <li class='collection-item'>
            チームがありません。
          </li>
        <% end %>
        <a href='/teams/new' class='collection-item blue-text right'>チームを作成する</a>
      </div>
    </div>
    <div class='col s12 m6'>
      <ul class='collection with-header'>
        <li class="collection-header"><h5>発表一覧</h5></li>
        <% if @entries.any? %>
          <% @entries.each do |entry| %>
            <li class='collection-item avatar'>
              <img src='<%= entry['avatar_url'] %>' alt='<% entry['author_name'] %>' class='circle'>
              <span class='title'><a href='/entries/<%= entry['id'] %>'><%= entry['title'] %></a></span>
              <p class='grey-text'>by <%= entry['author_name'] %> <small>(<a href="/teams/<%= entry['team_id']%>"><%= entry['team_name'] %></a>)</small></p>
            </li>
          <% end %>
        <% else %>
          <li class='collection-item'>
            登録されている発表はありません。
          </li>
        <% end %>
      </ul>
    </div>
  </div>
  <div class='row center'>
    <div class='col s12'>
      <h4>使い方</h4>
      <p>チームを(作成|参加)して、チームに対して発表を登録してください。枠の配分は発表単位で行います。</p>
    </div>
  </div>
</div>

<script type='text/javascript'>
window.onload = function() {
  var days = document.getElementById('days');
  var time = document.getElementById('time');
  var calcRestTime = function(cb) {
    var current = new Date();
    var deadLine = new Date('2017/12/16 17:00:00');
    var diffTime = deadLine.getTime() - current.getTime();
    var days = Math.floor(diffTime / (1000 * 60 * 60 * 24));
    diffTime -= days * (1000 * 60 * 60 * 24);
    var hours = Math.floor(diffTime / (1000 * 60 * 60));
    diffTime -= hours * (1000 * 60 * 60);
    var minutes = Math.floor(diffTime / (1000 * 60));
    diffTime -= minutes * (1000 * 60);
    var seconds = Math.floor(diffTime / (1000));

    cb(days, hours, minutes, seconds);
  };
  var tick = function() {
    calcRestTime(function(day, hour, min, sec) {
      days.innerText = day;
      var paddedHour = hour < 10 ? '0' + hour : hour;
      var paddedMin = min < 10 ? '0' + min : min;
      var paddedSec = sec < 10 ? '0' + sec : sec;

      time.innerText = paddedHour + ':' + paddedMin + ':' + paddedSec;
      setTimeout(tick, 1000);
    });
  };
  tick();
};
</script>
